{"version":3,"file":"index.mjs","sources":["../src/utils.ts","../src/Session.ts","../src/SessionManager.ts","../src/Encoder.ts","../src/index.ts"],"sourcesContent":["import _debug from 'debug'\nimport type { CookieOptions } from 'hono/utils/cookie'\nimport type { Context } from 'hono'\nimport type { Encoder } from './Encoder'\n\nexport const debug = _debug('hono-session')\n\nexport const secondsInADay = 24 * 60 * 60\n\nexport interface SessionOptions {\n  store?: SessionStore | null\n  encoder?: Encoder | null\n  secret?: string\n  maxAge?: number\n  cookieName?: string\n  cookieOptions?: CookieOptions\n}\n\nexport type MaybePromise<T> = T | Promise<T>\n\nexport interface SessionStore {\n  get: (sid: string, c: Context) => MaybePromise<Record<string, any> | null | undefined>\n  set: (sid: string, data: Record<string, any>, c: Context) => MaybePromise<unknown>\n  delete: (sid: string, c: Context) => MaybePromise<unknown>\n}\n","import { debug } from './utils'\nimport { SessionManager } from './SessionManager'\n\nexport class Session {\n  readonly #manager: SessionManager\n  readonly #initialState: string\n  #isNew: boolean\n  #oldFlashKeys?: string[]\n\n  _flashKeys?: string[]\n  _expires: number\n\n  constructor (manager: SessionManager, data?: Record<string, any> | null) {\n    this.#manager = manager\n    this._expires = Date.now() + manager.options.maxAge * 1000\n    this.#isNew = !data\n    Object.assign(this, data)\n    this.#initialState = JSON.stringify(this.toJSON())\n    this.#oldFlashKeys = this._flashKeys\n    this._flashKeys = undefined\n  }\n\n  get hasChanged (): boolean {\n    return this.#initialState !== JSON.stringify(this.toJSON())\n  }\n\n  get isNew (): boolean {\n    return this.#isNew\n  }\n\n  toJSON () {\n    return Object.fromEntries(\n      Object.entries(this)\n        .filter(([_, value]) => !(\n          value == null ||\n          (Array.isArray(value)\n            ? !value.length\n            : typeof value === 'object' && !Object.keys(value).length)\n        ))\n    )\n  }\n\n  renew (maxAge?: number) {\n    this._expires = Date.now() + (maxAge ?? this.#manager.options.maxAge) * 1000\n    this.#manager.forceCommit = true\n  }\n\n  async regenerate () {\n    return this.#manager.regenerate()\n  }\n\n  /** Store a value in the session for only the next request */\n  flash <T extends keyof this & string>(key: T, value: this[T]) {\n    this[key] = value\n    this._flashKeys ??= []\n    if (!this._flashKeys.includes(key)) this._flashKeys.push(key)\n    if (this.#oldFlashKeys) {\n      const idx = this.#oldFlashKeys.indexOf(key)\n      if (~idx) this.#oldFlashKeys.splice(idx, 1)\n    }\n  }\n\n  /** Keep all flashed values for an extra request */\n  reflash () {\n    if (!this.#oldFlashKeys?.length) return\n    debug('keeping flashed keys', this.#oldFlashKeys, 'and', this._flashKeys)\n    const set = [...this.#oldFlashKeys]\n    if (this._flashKeys?.length) set.push(...this._flashKeys)\n    this._flashKeys = Array.from(new Set(set))\n    this.#oldFlashKeys = undefined\n  }\n\n  /** Remove flashed values from the previous request */\n  ageFlash () {\n    debug('clearing flashed keys', this.#oldFlashKeys)\n    this.#oldFlashKeys?.forEach(key => {\n      (this as any)[key] = undefined\n    })\n    this.#oldFlashKeys = this._flashKeys\n  }\n}\n","import { SessionOptions, debug } from './utils'\nimport { Session } from './Session'\nimport { Context } from 'hono'\nimport { getCookie } from 'hono/cookie'\nimport { deleteCookie, setCookie } from 'hono/cookie'\n\nexport class SessionManager {\n  session?: Session | false\n  sessionKey?: string\n  forceCommit = false\n\n  constructor (\n    public options: Required<SessionOptions>,\n    public ctx: Context\n  ) {}\n\n  get () {\n    debug('get', this.session)\n    const session = this.session\n    if (session) return session\n    if (session === false) return null\n    this.create()\n    return this.session\n  }\n\n  set (value: any) {\n    debug('set', value)\n    if (value == null) {\n      this.session = false\n    } else if (typeof value === 'object') {\n      this.create(value, this.sessionKey)\n    } else {\n      throw new TypeError('Session can only be set to an object or null')\n    }\n  }\n\n  create (data?: any, sessionKey?: string) {\n    debug('create session with data', data, 'key', sessionKey)\n    const expires = data?._expires\n    if (typeof expires === 'number' && expires < Date.now()) {\n      data = undefined\n      sessionKey = undefined\n    }\n    this.session = data instanceof Session ? data : new Session(this, data)\n    if (this.options.store) this.sessionKey = sessionKey || globalThis.crypto.randomUUID()\n  }\n\n  async initFromStore () {\n    if (!this.options.store) return\n\n    const key = getCookie(this.ctx, this.options.cookieName)\n\n    if (!key) {\n      this.create()\n      return\n    }\n\n    const data = await this.options.store.get(key, this.ctx)\n\n    this.create(data, key)\n  }\n\n  async initFromCookie () {\n    if (!this.options.encoder) return\n\n    const decode = this.options.encoder.decode\n\n    const cookie = getCookie(this.ctx, this.options.cookieName)\n\n    if (!cookie) {\n      this.create()\n      return\n    }\n\n    let data\n    try {\n      data = await decode(cookie, this.options.secret)\n    } catch (err) {\n      this.create()\n    }\n\n    this.create(data)\n  }\n\n  async regenerate () {\n    const session = this.session\n    this.session = false\n    await this.commit()\n    this.create(session)\n    this.forceCommit = true\n    return this.session as any as Session\n  }\n\n  async commit () {\n    if (!this.session) {\n      if (this.session === false) {\n        debug('removing session', this.sessionKey)\n        if (this.options.store) await this.options.store.delete(this.sessionKey!, this.ctx)\n        deleteCookie(this.ctx, this.options.cookieName, this.options.cookieOptions)\n      }\n      return\n    }\n\n    this.session.ageFlash()\n    if (!this.session.hasChanged && !this.forceCommit) {\n      debug('session has not been changed')\n      return\n    }\n\n    if (this.options.store) {\n      debug('saving to store', this.sessionKey)\n      await this.options.store.set(this.sessionKey!, this.session.toJSON(), this.ctx)\n      setCookie(this.ctx, this.options.cookieName, this.sessionKey!, this.options.cookieOptions)\n    } else {\n      debug('saving to cookie')\n      const encode = this.options.encoder!.encode\n      setCookie(\n        this.ctx,\n        this.options.cookieName,\n        await encode(this.session.toJSON(), this.options.secret),\n        this.options.cookieOptions\n      )\n    }\n  }\n}\n","import * as Iron from 'iron-webcrypto'\nimport { MaybePromise } from './utils'\n\nexport interface Encoder {\n  encode: (data: Record<string, any>, secret: string) => MaybePromise<string>\n  decode: (data: string, secret: string) => MaybePromise<Record<string, any> | null>\n}\n\nexport const defaultEncoder = {\n  encode (data, secret) {\n    return Iron.seal(globalThis.crypto, data, secret, Iron.defaults)\n  },\n  decode (data, secret) {\n    return Iron.unseal(globalThis.crypto, data, secret, Iron.defaults)\n  },\n} satisfies Encoder\n","import { createMiddleware } from 'hono/factory'\nimport { secondsInADay } from './utils'\nimport { SessionManager } from './SessionManager'\nimport { defaultEncoder } from './Encoder'\nimport type { Session } from './Session'\nimport type { SessionStore, SessionOptions } from './utils'\n\nexport type {\n  Session,\n  SessionManager,\n  SessionOptions,\n  SessionStore,\n}\n\nexport default function<\n  T extends Record<string, any>\n>(_options?: SessionOptions) {\n  const options = {\n    encoder: defaultEncoder,\n    maxAge: 1 * secondsInADay,\n    cookieName: 'sid',\n    ..._options,\n    cookieOptions: {\n      secure: true,\n      httpOnly: true,\n      ..._options?.cookieOptions,\n    },\n  } as Required<SessionOptions>\n  options.cookieOptions.maxAge ??= options.maxAge\n  options.secret ??= String.fromCodePoint(...globalThis.crypto.getRandomValues(new Uint8Array(32)))\n\n  return createMiddleware<{\n    Variables: { session: Session & T }\n  }>(async (c, next) => {\n    const manager = new SessionManager(options, c)\n    if (options.store) await manager.initFromStore()\n    else await manager.initFromCookie()\n\n    Object.defineProperty(c, 'session', {\n      get: () => manager.get(),\n      set: (value: any) => {\n        manager.set(value)\n      },\n      enumerable: true,\n      configurable: true,\n    })\n    const get = c.get\n    const set = c.set\n    Object.defineProperty(c, 'get', {\n      value: (key: string) => {\n        if (key === 'session') {\n          return manager.get()\n        }\n        return get(key as any)\n      },\n      enumerable: true,\n      configurable: true,\n    })\n    Object.defineProperty(c, 'set', {\n      value: (key: string, value: any) => {\n        if (key === 'session') {\n          manager.set(value)\n          return\n        }\n        set(key as any, value)\n      },\n      enumerable: true,\n      configurable: true,\n    })\n\n    try {\n      await next()\n    } finally {\n      await manager.commit()\n    }\n  })\n}\n"],"names":[],"mappings":"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"}